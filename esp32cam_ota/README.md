# ESP8266 Advanced Clock

Часы построены на базе платформы NodeMCU и дисплея LCD1602

## Распиновка
- **A0** - аналоговый пин для получения спектрограммы
- **D1** - SCL на дисплее
- **D2** - SDA на дисплее
- **D5** - датчик DHT11
- **D6** - кнопка (подключена к +5V, необходимо подтянуть к земле)
- **D7** - вибромотор (можно использовать любой другой модуль, например реле)

## Особенности
- Нет строгой привязки к точке доступа WiFi (плата подключается автоматически без явного указания точки доступа либо создаёт свою точку доступа для удобной настройки)
- Несколько режимов работы:
  - Погода в помещении/на улице на основании DHT11 и OpenWeatherMap; текущие время, день недели
  - Режим спектрограммы аудиосигнала

## Использованные библиотеки

Список некоторых использованных библиотек:

- [AutoConnect](https://github.com/Hieromon/AutoConnect) - мощнейшая библиотека управления Wifi для ESP8266/ESP32
- [GyverButton](https://github.com/AlexGyver/GyverLibs#GyverButton) - лёгкое управление кнопкой
- [LCD_1602_RUS_ALL](https://github.com/ssilver2007/LCD_1602_RUS_ALL) - работа с LCD_1602 с использованием русских символов



## Установка

Первичную установку необходимо провести через ArduinoIDE, указав в настройках некоторые особенности для возможности OTA-обновления прошивки:
![esp8266_setup](https://raw.githubusercontent.com/zortald/esp8266_advanced_clock/master/img/esp8266_setup.png)

Обновление прошивки можно производить без участия ПК (вместо 192.168.1.7 укажите адрес esp8266 в своей сети:
![esp8266_firmware_upgrade](https://raw.githubusercontent.com/zortald/esp8266_advanced_clock/master/img/esp8266_firmware_upgrade.png)


## Настройка

Устанавливаем через ArduinoIDE, после прошивки подключаемся к плате, которая создаст точку доступа **esp8266ap** с паролем **12345678**. 
- Переходим по [адресу](http://172.217.28.1/settings) и указываем все параметры.
- Переходим по [адресу](http://172.217.28.1/_ac/config) и выбираем существующую точку доступа

## Управление
По умолчанию отображается текущая погода и время.
- Нажатие и удержание кнопки - переход в режим **погода/время** (работает в любом режиме) и отключение "нагрузки" (**digitalWrite(vibroPin, LOW);**)
  - идентично **http://esp8266.ip/time_mode**
- Одинарный клик - вывод текущего IP-адреса, точки доступа и включение "нагрузки" (**digitalWrite(vibroPin, HIGH);**) ***
  - идентично **http://esp8266.ip/ip**
- Двойной клик - включение режима спектроанализатора
  - идентично **http://esp8266.ip/spectrum_mode**
- Тройной клик - обновление погоды ***
- Десятикратное нажатие - перезагрузка платы. ***

Количество нажатий показывается на дисплее.

***Работает только из режима **погода/время**

## TODO

Реализация будильника (сейчас работает каждый день в 07:30, 07:40 и 07:50. Для отключения - удержание кнопки)